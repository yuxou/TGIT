package controller.accommodation;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import controller.Controller;
import model.dao.PlanDAO;
import model.domain.Accommodation;
import java.util.Arrays;

public class AddAccommodationController implements Controller {

    @Override
    public String execute(HttpServletRequest request, HttpServletResponse response) {
        try {
            // 요청 파라미터에서 데이터 가져오기
            int planId = Integer.parseInt(request.getParameter("planId"));
            String name = request.getParameter("name");

            // 체크인 및 체크아웃 날짜를 파싱하여 연, 월, 일을 추출
            String[] checkInParts = request.getParameter("checkInDate").split("-");
            String[] checkOutParts = request.getParameter("checkOutDate").split("-");

            int checkInYear = Integer.parseInt(checkInParts[0]);
            int checkInMonth = Integer.parseInt(checkInParts[1]);
            int checkInDay = Integer.parseInt(checkInParts[2]);

            int checkOutYear = Integer.parseInt(checkOutParts[0]);
            int checkOutMonth = Integer.parseInt(checkOutParts[1]);
            int checkOutDay = Integer.parseInt(checkOutParts[2]);

            double cost = Double.parseDouble(request.getParameter("cost"));

            // Accommodation 객체 생성
            Accommodation accommodation = new Accommodation(0, name, checkInYear, checkInMonth, checkInDay, 
                                                             checkOutYear, checkOutMonth, checkOutDay, cost);

            // PlanDAO를 통해 숙소 추가
            PlanDAO planDAO = new PlanDAO();
            planDAO.addAccommodationsToPlan(planId, Arrays.asList(accommodation)); // 리스트로 전달

            // 성공적으로 추가된 경우 계획 상세 페이지로 리다이렉트
            return "/plan/viewPlan.jsp?planId=" + planId;

        } catch (Exception e) {
            e.printStackTrace();
            // 에러 발생 시 에러 페이지로 이동
            request.setAttribute("errorMessage", "숙소를 추가하는 중 오류가 발생했습니다.");
            return "/error.jsp";
        }
    }
}